<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Metal Price Tracker â€“ Last 7 Days</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 16px;
  background: #fafafa;
}

h1 {
  text-align: center;
}

h2 {
  margin-top: 32px;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 8px;
  background: #fff;
}

th, td {
  padding: 10px;
  border: 1px solid #ddd;
  text-align: center;
}

th {
  background: #f0f0f0;
}

.up {
  color: #c62828;   /* red */
  font-weight: bold;
}

.down {
  color: #2e7d32;  /* green */
  font-weight: bold;
}

.same {
  color: #444;
}

@media (max-width: 768px) {
  th, td {
    font-size: 14px;
    padding: 6px;
  }
}

.footer {
  margin-top: 40px;
  font-size: 13px;
  color: #555;
  text-align: center;
}
</style>
</head>

<body>

<h1>ðŸ“Š Metal Prices (Last 7 Days)</h1>

<h2>ðŸŸ¡ Gold</h2>
<h3>22K (â‚¹ / gram)</h3>
<table id="gold-22k-table"></table>

<h3>24K (â‚¹ / gram)</h3>
<table id="gold-24k-table"></table>

<h2>âšª Silver</h2>
<table id="silver-table"></table>

<h2>ðŸŸ¤ Copper (â‚¹ / kg)</h2>
<table id="copper-table"></table>

<div class="footer" id="updated"></div>

<script>
async function loadJSON(path) {
  const res = await fetch(path);
  return await res.json();
}

function last7(data) {
  return data.slice(-7).reverse();
}

/* ---------- GOLD (compare within same purity only) ---------- */
function renderGoldTable(el, rows, purity) {
  let html = `
    <tr>
      <th>Date</th>
      <th>Price (â‚¹/g)</th>
      <th>Source</th>
    </tr>
  `;

  const series = rows.filter(r => (r.purity || "").toString().toUpperCase() === purity.toString().toUpperCase());

  series.forEach((r, i) => {
    const prev = series[i + 1]?.price_per_gram_inr;
    let cls = "same";

    if (prev !== undefined) {
      if (r.price_per_gram_inr > prev) cls = "up";
      else if (r.price_per_gram_inr < prev) cls = "down";
    }

    html += `
      <tr>
        <td>${r.date}</td>
        <td class="${cls}">${r.price_per_gram_inr}</td>
        <td>${r.source}</td>
      </tr>
    `;
  });

  el.innerHTML = html;
}

/* ---------- GENERIC TABLE (silver, copper) ---------- */
function renderSeriesTable(el, headers, rows, priceKey) {
  let html = "<tr>" + headers.map(h => `<th>${h}</th>`).join("") + "</tr>";

  rows.forEach((r, i) => {
    const prev = rows[i + 1]?.[priceKey];
    let cls = "same";

    if (prev !== undefined) {
      if (r[priceKey] > prev) cls = "up";
      else if (r[priceKey] < prev) cls = "down";
    }

    html += "<tr>" + headers.map(h => {
      if (h === priceKey) {
        return `<td class="${cls}">${r[h]}</td>`;
      }
      return `<td>${r[h] ?? ""}</td>`;
    }).join("") + "</tr>";
  });

  el.innerHTML = html;
}

async function init() {
  const gold = last7(await loadJSON("data/gold.json"));
  const silver = last7(await loadJSON("data/silver.json"));
  const copper = last7(await loadJSON("data/copper.json"));

  renderGoldTable(document.getElementById("gold-22k-table"), gold, "22K");
  renderGoldTable(document.getElementById("gold-24k-table"), gold, "24K");

  renderSeriesTable(
    document.getElementById("silver-table"),
    ["date", "price_per_gram_inr", "price_per_kg_inr", "source"],
    silver,
    "price_per_kg_inr"
  );

  renderSeriesTable(
    document.getElementById("copper-table"),
    ["date", "price_per_kg_inr", "source"],
    copper,
    "price_per_kg_inr"
  );

  const lastDate = gold.length ? gold[0].date : "N/A";
  document.getElementById("updated").innerText =
    "Last updated: " + lastDate +
    " | ðŸ”´ Increase | ðŸŸ¢ Decrease | Compared vs previous day";
}

init();
</script>

</body>
</html>
